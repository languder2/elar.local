<?php

namespace App\Controllers;
use App\Models\PublicModel;
use CodeIgniter\HTTP\RedirectResponse;
use CodeIgniter\HTTP\RequestInterface;
use CodeIgniter\HTTP\ResponseInterface;
use Psr\Log\LoggerInterface;

class PublicController extends BaseController
{
    private PublicModel $pbl;
    public function initController(RequestInterface $request, ResponseInterface $response, LoggerInterface $logger)
    {
        parent::initController($request, $response, $logger); // TODO: Change the autogenerated stub
        $this->pbl= model(PublicModel::class);
    }
    public function MainList($id=false,$pg=0):string|RedirectResponse{
        $page['data']["title"]= "Электронный научный архив МелГУ: Главаня страница";

        if($this->session->has("collectionsFilter"))
            $page['data']['filter']= $this->session->get("MainFilter");

        $page['data']['edSections']= $this->pbl->getSectionsList();

        $page['pageContent']= view("public/main",$page['data']);
        return view("public/page",$page);
    }
    public function ChapterList($id=false,$pg=0):string|RedirectResponse{
        $page['data']["title"]= "Электронный научный архив МелГУ: ";

        if($this->session->has("collectionsFilter"))
            $page['data']['filter']= $this->session->get("MainFilter");

        $page['data']['edSections']= $this->pbl->getChapterList($id);
        $page['data']['TitleSections']= $this->pbl->getTitleSection($id);


        $page['pageContent']= view("public/chapter",$page['data']);
        return view("public/page",$page);
    }
    public function SubChapterList($id=false,$pg=0):string|RedirectResponse{
        $page['data']["title"]= "Электронный научный архив МелГУ: ";

        if($this->session->has("collectionsFilter"))
            $page['data']['filter']= $this->session->get("MainFilter");

        $page['data']['edCollections']= $this->pbl->getSubChapterList($id);
        $url_path = $_SERVER['REQUEST_URI'];
        $path = parse_url($url_path);
        $id = explode('/', $path['path']);
        $page['data']['TitleChapter']= $this->pbl->getSubTitleChapter($id[4]);


        $page['pageContent']= view("public/subchapter",$page['data']);
        return view("public/page",$page);
    }
        public function CollectionsList($id=false,$pg=0):string|RedirectResponse{
        $page['data']["title"]= "Электронный научный архив МелГУ: ";

        if($this->session->has("collectionsFilter"))
            $page['data']['filter']= $this->session->get("MainFilter");

        $page['data']['edCollections']= $this->pbl->getCollectionsList($id);
        $page['data']['TitleChapter']= $this->pbl->getSubTitleChapter($id);


        $page['pageContent']= view("public/subchapter",$page['data']);
        return view("public/page",$page);
    }

}
